---
import { getCategoriesInfo } from "../../lib/wp/getCategoriesInfo.js";

const { lang } = Astro.params;
const categoriesMap = await getCategoriesInfo(lang);

const path = Astro.url.pathname.replace(/^\/|\/$/g, "");
const lastSegment = path.split("/").pop().toLowerCase();

let currentCategory = null;
let currentCategoryId = null;

for (const parent of categoriesMap.parent) {
  if (lastSegment === parent.slug.toLowerCase()) {
    currentCategory = parent.title;
    currentCategoryId = parent.id;
    break;
  }

  const subcategories = categoriesMap.children[parent.id] || [];
  for (const sub of subcategories) {
    if (lastSegment === sub.slug.toLowerCase()) {
      currentCategory = parent.title;
      currentCategoryId = parent.id;
      break;
    }
  }

  if (currentCategory) break;
}
---

{currentCategory && (
  <>
    <!-- Banner de categoría -->
    <div class="bg-secondary text-white px-4 py-2 font-bold text-lg w-full text-center">
      {currentCategory}
    </div>

    <!-- Subcategorías en scroll horizontal -->
    {currentCategoryId && categoriesMap.children[currentCategoryId]?.length > 0 && (
      <nav class="flex gap-6 px-4 py-3 bg-gray-50 border-b border-gray-200 overflow-x-auto whitespace-nowrap">
        {categoriesMap.children[currentCategoryId].map((sub) => {
          const isActive = sub.slug.toLowerCase() === lastSegment;
          return (
            <a
              href={`/${lang}/${sub.slug}`}
              class={`text-sm relative pb-1 ${
                isActive
                ? "font-bold text-black after:content-[''] after:absolute after:left-0 after:bottom-0 after:h-[4px] after:w-full after:bg-secondary"
                : "text-gray-500 hover:text-gray-800"
              }`}
            >
              {sub.title}
            </a>
          );
        })}
      </nav>
    )}
  </>
)}
